/*
 * Panes.js - 0.0.1 
 * Author : Jacob Lowe <http://jacoblowe.me> 
 */

(function(t,i){var s=function(t,i){return this instanceof s?(this.locked=null,this.current=1,this.position=0,this.direction="horizontal"===i?1:0,this.ele=t,this.els=t.find("> *"),this.top=this.direction?t.position().left:t.position().top,this.view=this.direction?this.els.outerWidth(!0):this.els.outerHeight(!0),this.threshold=this.view/10,this.animating=0,this.max=this.els.length,this.touch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:!1,this.transform=function(){var t,s=document.body||document.documentElement,e=s.style,n="transform";if("string"==typeof e[n])return n;t=["Moz","Webkit","Khtml","O","ms"],n=n.charAt(0).toUpperCase()+n.substr(1);for(var o=0;t.length>o;o++)if("string"==typeof e[t[o]+n])return t[o]+n;return i?"top":"left"}(),this.transition=function(){var t,i=document.body||document.documentElement,s=i.style,e="transition";if("string"==typeof s[e])return e;t=["Moz","Webkit","Khtml","O","ms"],e=e.charAt(0).toUpperCase()+e.substr(1);for(var n=0;t.length>n;n++)if("string"==typeof s[t[n]+e])return t[n]+e;return null}(),this.prefixed=this.transition?"-"+this.transform.split(/tran/i).join("-tran").toLowerCase():null,this.ele.css(this.transform,this.Css(0)),this.eleTop=this.Css(t),this.move=/transform/.test(this.transform)?"animate":"css",this.axis=this.direction?"width":"height",this.page=this.direction?"pageX":"pageY",this.init(),void 0):new s(t,i)};s.prototype.lock=function(){this.locked=!0},s.prototype.speed=null,s.prototype.Css=function(t){return t instanceof jQuery?/transform/i.test(this.transform)?this.direction?parseFloat(t.css(this.transform).split(/\(/)[1].split(/\,/)[4]):parseFloat(t.css(this.transform).split(/\(/)[1].split(/\,/).pop()):t.css(this.transform):/transform/i.test(this.transform)?this.direction?"translate3d("+(/px/.test(t)?t:t+"px")+",0,0)":"translate3d(0,"+(/px/.test(t)?t:t+"px")+",0)":t},s.prototype.goto=function(t,i){var s,e={},n=this;return this.current!==t&&(s=!0),this.prev=this.current,t=parseFloat(t),1>t||t>this.max?!1:(this.current=t,e[this.transform]=this.Css(-(this.view-2)*(t-1)),this.transition&&(e[this.transition]=n.prefixed+" "+i+"s ease-out 0s"),this.animating=1,this.ele[this.move](e),setTimeout(function(){n.animating=0,n.ele.removeClass("animate"),n.onChange&&s&&n.onChange(n.current,n.els.length)},500),void 0)},s.prototype.events=function(){var t=this;this.clock=function(){var i=t.position;setTimeout(function(){i=t.position-i,t.speed=i/50},50)},this.drag=function(i){if(i.preventDefault(),t.start&&!t.animating&&!t.locked){var s=i.originalEvent.touches[0][t.page],e=s-t.top-t.start,n=e+t.eleTop;t.onScroll&&t.onScroll(e),t.ele.css(t.transform,t.Css(n)),t.position=e}},this.dragend=function(){if(clearInterval(t.timer),!t.locked){t.onScrollStop&&t.onScrollStop();var i=0>t.speed?-1*t.speed:t.speed,s=0>this.position?-1*this.position:this.position,e=i?(this.view-s)/i/1e3:".5";(t.position>t.threshold||.5>e&&this.position>0)&&1!==t.current?(e>.5&&(e=.5),t.goto(t.current-1,e)):(t.position<-1*t.threshold||.5>e&&0>this.position)&&t.current!==t.max?(e>.5&&(e=.5),t.goto(t.current+1,e)):t.goto(t.current,.5)}},this.touchStart=function(i){t.time=0,t.timer=setInterval(t.clock,50),t.position=0;var s={};t.transition&&(s[t.transition]="none"),i.preventDefault(),t.start=i.originalEvent.touches[0][t.page]-t.top,t.eleTop=t.Css(t.ele),t.ele.css(s).bind("touchmove",t.drag)},this.touchEnd=function(i){t.animating||(i.preventDefault(),t.start=null,t.dragend(),t.ele.unbind("touchmove",t.drag))}},s.prototype.listen=function(){this.ele.on("touchstart",this.touchStart),this.ele.on("touchend",this.touchEnd)},s.prototype.init=function(){var t={};t[this.axis]=this.els.length*this.view+"px",this.ele.css(t),this.events(),this.listen()},i.Panes=s})(jQuery,this);